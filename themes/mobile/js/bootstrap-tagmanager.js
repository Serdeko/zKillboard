(function(c){if("undefined"===typeof console||"undefined"===typeof console.log)console={log:function(){}};c.fn.tagsManager=function(q,w){var a={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,typeahead:!1,typeaheadAjaxSource:null,typeaheadAjaxPolling:!1,typeaheadOverrides:null,typeaheadSource:null,AjaxPush:null,AjaxPushAllTags:null,delimeters:[44,188,13,9],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,deleteTagsOnBackspace:!0,tagsContainer:null,
tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1};if(!(0 in this))return this;a.typeaheadOverrides=new function(){this.instanceSelectHandler=null;this.selectedClass="selected";this.select=null;"typeahead"in c.fn&&(this.instanceSelectHandler=c.fn.typeahead.Constructor.prototype.select,this.select=function(a){this.$menu.find(".active").addClass(a.selectedClass);a.instanceSelectHandler.apply(this,arguments)})};c.extend(a,q);null===a.hiddenTagListName&&(a.hiddenTagListName="hidden-"+this.attr("name"));
var b=this,k=b.attr("name").replace(/[^\w]/g,"_"),m="",r=a.delimeters,x=a.backspace,u=function(a,b,d){"d"in a&&(a=a.d);if(a&&a.tags){var e=[];e.length=0;c.each(a.tags,function(a,l){e.push(l.tag);b&&t(e)});c.isFunction(d)&&d(e)}},t=function(a){b.data("active",!0);b.data("typeahead").source=a;b.data("active",!1)},y=function(b,g){"string"==typeof a.typeaheadAjaxSource&&c.ajax({cache:!1,type:"POST",contentType:"application/json",dataType:"json",url:a.typeaheadAjaxSource,data:JSON.stringify({typeahead:b}),
success:function(a){u(a,!1,g)}})},n=function(a){a=c.trim(a);for(var b=a.length,d=0,e=b-1;0<=e&&-1!=c.inArray(a.charCodeAt(e),r);e--)d++;a=a.substring(0,b-d);b=a.length;for(e=d=0;e<b&&-1!=c.inArray(a.charCodeAt(e),r);e++)d++;return a=a.substring(d,b)},v=function(){var a=b.data("tlis"),g=b.data("tlid");0<g.length&&(g=g.pop(),a.pop(),c("#"+k+"_"+g).remove(),p())},p=function(){var a=b.data("tlis"),g=b.data("lhiddenTagList");b.trigger("tags:refresh",a.join(","));g&&c(g).val(a.join(",")).change()},s=function(b,
g){a.AjaxPushAllTags&&c.post(a.AjaxPushAllTags,{tags:g})},h=function(f,g,d){if(f&&(d&&!(0>=f.length))&&(!a.onlyTagList||!(null!=a.typeaheadSource&&-1==c.inArray(f,a.typeaheadSource))))if(a.CapitalizeFirstLetter&&1<f.length&&(f=f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()),!c.isFunction(a.validator)||a.validator(f))if(g=b.data("tlis"),d=b.data("tlid"),!(0<a.maxTags&&g.length>=a.maxTags)){var e=!1,h=g.map(function(a){return a.toLowerCase()}),h=c.inArray(f.toLowerCase(),h);-1!=h&&(e=!0);e?c("#"+
k+"_"+d[h]).stop().animate({backgroundColor:a.blinkBGColor_1},100).animate({backgroundColor:a.blinkBGColor_2},100).animate({backgroundColor:a.blinkBGColor_1},100).animate({backgroundColor:a.blinkBGColor_2},100).animate({backgroundColor:a.blinkBGColor_1},100).animate({backgroundColor:a.blinkBGColor_2},100):(e=Math.max.apply(null,d),e=-Infinity==e?0:e,e=++e,g.push(f),d.push(e),null!=a.AjaxPush&&c.post(a.AjaxPush,{tag:f}),d=k+"_Remover_"+e,f=""+('<span class="myTag'+(a.tagClass?" "+a.tagClass:"")+'" id="'+
(k+"_"+e)+'"><span>'+f+'&nbsp;&nbsp;</span><a href="#" class="myTagRemover" id="'+d+'" TagIdToRemove="'+e+'" title="Remove">'+a.tagCloseIcon+"</a></span> "),null!=a.tagsContainer?c(a.tagsContainer).append(f):b.before(f),c("#"+d).on("click",b,function(l){l.preventDefault();l=parseInt(c(this).attr("TagIdToRemove"));var d=b.data("tlis"),e=b.data("tlid"),f=c.inArray(l,e);-1!=f&&(c("#"+k+"_"+l).remove(),d.splice(f,1),e.splice(f,1),p());0<a.maxTags&&d.length<a.maxTags&&b.show()}),p(),0<a.maxTags&&g.length>=
a.maxTags&&b.hide());b.val("")}};if(a.AjaxPushAllTags)b.on("tags:refresh",s);return this.each(function(){var f=!1,g=!1;if("string"==typeof q)switch(q){case "empty":for(var d=b.data("tlis"),e=b.data("tlid");0<e.length;){var s=e.pop();d.pop();c("#"+k+"_"+s).remove();p()}break;case "popTag":v();break;case "pushTag":h(w,null,!0)}else{b.data("tlis",[]);b.data("tlid",[]);null==a.hiddenTagListId?(d=$("input[name='"+a.hiddenTagListName+"']"),0<d.length&&d.remove(),d=""+("<input name='"+a.hiddenTagListName+
"' type='hidden' value=''/>"),b.after(d),b.data("lhiddenTagList",b.siblings("input[name='"+a.hiddenTagListName+"']")[0])):b.data("lhiddenTagList",c("#"+a.hiddenTagListId));if(a.typeahead&&b.typeahead&&(null!=a.typeaheadSource&&c.isFunction(a.typeaheadSource)?b.typeahead({source:a.typeaheadSource}):null!=a.typeaheadSource?(b.typeahead(),t(a.typeaheadSource)):null!=a.typeaheadAjaxSource?a.typeaheadAjaxPolling?a.typeaheadAjaxPolling&&b.typeahead({source:y}):(b.typeahead(),"string"==typeof a.typeaheadAjaxSource&&
c.ajax({cache:!1,type:"POST",contentType:"application/json",dataType:"json",url:a.typeaheadAjaxSource,data:JSON.stringify({typeahead:""}),success:function(a){u(a,!0)}})):a.typeaheadDelegate&&b.typeahead(a.typeaheadDelegate),d=b.data("typeahead")))d.select=c.proxy(a.typeaheadOverrides.select,b.data("typeahead"),a.typeaheadOverrides);b.on("focus",function(){c(this).popover&&c(this).popover("hide")});if(a.isClearInputOnEsc)b.on("keyup",function(a){if(27==a.which)return c(this).val(""),a.cancelBubble=
!0,a.returnValue=!1,a.stopPropagation(),a.preventDefault(),!1});b.on("keypress",function(b){c(this).popover&&c(this).popover("hide");if(a.preventSubmitOnEnter&&13==b.which)return b.cancelBubble=!0,b.returnValue=!1,b.stopPropagation(),b.preventDefault(),!1;var d=c.inArray(b.which,r);!("0"in c(".typeahead:visible"))&&-1!=d?(f=!0,d=c(this).val(),d=n(d),h(d,b.data,f),b.preventDefault()):f=!1});if(a.deleteTagsOnBackspace)b.on("keydown",b,function(a){-1!=c.inArray(a.which,x)&&0>=c(this).val().length&&(a.preventDefault(),
v())});b.change(function(b){b.cancelBubble=!0;b.returnValue=!1;b.stopPropagation();b.preventDefault();b=a.typeaheadOverrides.selectedClass;var d="."+b;$(this).data("typeahead")&&(g=$(this).data("typeahead").$menu.find("*").filter(d).hasClass(b))&&(f=!0);if(!f)return!1;var e=-1<navigator.userAgent.indexOf("Chrome");navigator.userAgent.indexOf("MSIE");navigator.userAgent.indexOf("Firefox");var j=-1<navigator.userAgent.indexOf("Safari");!e&&!j&&c(this).focus();void 0!=c(".typeahead:visible")[0]?(e=!g,
g&&(j=$(this).data("typeahead").$menu.find(d).attr("data-value"),j=n(j),m==c(this).val()&&m==j?e=!0:(h(j,null,!0),m=j),g=!1,$(this).data("typeahead").$menu.find(d).removeClass(b)),e&&(m="",c(this).val(m))):(j=c(this).val(),j=n(j),h(j,null,!0));return f=!1});b.on("blur",function(b){b.cancelBubble=!0;b.returnValue=!1;b.stopPropagation();b.preventDefault();b=!0;a.typeahead&&(b=void 0!=c(".typeahead:visible")[0]?!1:!0);b&&(b=c(this).val(),b=n(b),h(b,null,f));return!1});null!=a.prefilled&&("object"==typeof a.prefilled?
(d=a.prefilled,c.each(d,function(a,c){h(c,b,!0)})):"string"==typeof a.prefilled&&(d=a.prefilled.split(","),c.each(d,function(a,c){h(c,b,!0)})))}})}})(jQuery);